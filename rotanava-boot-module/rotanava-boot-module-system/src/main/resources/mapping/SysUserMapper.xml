<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rotanava.boot.system.module.dao.SysUserMapper">
    <sql id="Base_Column_List">
        id,
        user_account_name,
        user_name,
        user_password,
        user_passwd_salt,
        photo_bucket_name,
        photo_object_name,
        user_photo_url,
        user_birthday,
        user_sex,
        user_email,
        user_phone,
        user_safe_email,
        user_safe_phone,
        user_status,
        bef_user_status,
        user_code,
        user_occupation,
        create_by,
        create_time,
        update_by,
        update_time,
        user_sysrole,
        user_description,
        user_address,
        user_valid_time,
        user_is_online,
        user_delete_status
    </sql>
    <resultMap id="BaseResultMap" type="com.rotanava.boot.system.api.module.system.bo.SysUser">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="user_account_name" jdbcType="VARCHAR" property="userAccountName"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="user_password" jdbcType="VARCHAR" property="userPassword"/>
        <result column="user_passwd_salt" jdbcType="VARCHAR" property="userPasswdSalt"/>
        <result column="photo_bucket_name" jdbcType="VARCHAR" property="photoBucketName"/>
        <result column="photo_object_name" jdbcType="VARCHAR" property="photoObjectName"/>
        <result column="user_photo_url" jdbcType="VARCHAR" property="userPhotoUrl"/>
        <result column="user_birthday" jdbcType="TIMESTAMP" property="userBirthday"/>
        <result column="user_sex" jdbcType="INTEGER" property="userSex"/>
        <result column="user_email" jdbcType="VARCHAR" property="userEmail"/>
        <result column="user_phone" jdbcType="VARCHAR" property="userPhone"/>
        <result column="user_safe_email" jdbcType="VARCHAR" property="userSafeEmail"/>
        <result column="user_safe_phone" jdbcType="VARCHAR" property="userSafePhone"/>
        <result column="user_status" jdbcType="INTEGER" property="userStatus"/>
        <result column="bef_user_status" jdbcType="INTEGER" property="befUserStatus"/>
        <result column="user_code" jdbcType="VARCHAR" property="userCode"/>
        <result column="user_occupation" jdbcType="VARCHAR" property="userOccupation"/>
        <result column="create_by" jdbcType="INTEGER" property="createBy"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_by" jdbcType="INTEGER" property="updateBy"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="user_sysrole" jdbcType="INTEGER" property="userSysrole"/>
        <result column="user_description" jdbcType="VARCHAR" property="userDescription"/>
        <result column="user_address" jdbcType="VARCHAR" property="userAddress"/>
        <result column="user_valid_time" jdbcType="TIMESTAMP" property="userValidTime"/>
        <result column="user_is_online" jdbcType="INTEGER" property="userIsOnline"/>
        <result column="user_delete_status" jdbcType="INTEGER" property="userDeleteStatus"/>
    </resultMap>

    <!--auto generated by MybatisCodeHelper on 2021-03-03-->
    <select id="findByUserAccountName" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_account_name = #{userAccoutName}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-03-->
    <select id="findByUserAccountNameAndUserStatusAndUserDeleteStatusAndUserValidTimeLessThanEqual"
            resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_account_name = #{userAccountName}
          and user_status = #{userStatus}
          and user_delete_status = #{userDeleteStatus}
          and user_valid_time <![CDATA[<=]]> #{maxUserValidTime}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-03-->
    <select id="findByUserAccountNameAndUserDeleteStatus" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_account_name = #{userAccountName}
          and user_delete_status = #{userDeleteStatus}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-19-->
    <update id="updateUserSafeEmailById">
        update sys_user
        set user_safe_email=NULL,
            user_phone=NULL,
            update_time    = NOW()
        where id = #{id,jdbcType=INTEGER}
    </update>

    <!--auto generated by MybatisCodeHelper on 2021-03-19-->
    <update id="updateUserSafePhoneById">
        update sys_user
        set user_safe_phone=NULL,
            user_phone=NULL,
            update_time    = NOW()
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="findall" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-06-->
    <select id="findUserNameById" resultType="java.lang.String">
        select user_name
        from sys_user
        where id = #{id,jdbcType=INTEGER}
    </select>

    <select id="findId" resultType="java.lang.Integer">
        select id
        from sys_user
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-20-->
    <select id="findIdByUserCode" resultType="java.lang.Integer">
        select id
        from sys_user
        where user_code = #{userCode,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-20-->
    <select id="findIdByUserPhone" resultType="java.lang.Integer">
        select id
        from sys_user
        where user_phone = #{userPhone,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-20-->
    <select id="findIdByUserAccountName" resultType="java.lang.Integer">
        select id
        from sys_user
        where user_account_name = #{userAccountName,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-20-->
    <select id="findIdByUserName" resultType="java.lang.Integer">
        select id
        from sys_user
        where user_name = #{userName,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-03-20-->
    <select id="findIdByUserEmail" resultType="java.lang.Integer">
        select id
        from sys_user
        where user_email = #{userEmail,jdbcType=VARCHAR}
    </select>

    <update id="unbindEmail">
        update sys_user
        set user_email      = null,
            user_safe_email = null,
            update_time     =#{update}
        where id = #{userId}
    </update>

    <update id="unbindPhone">
        update sys_user
        set user_phone      = null,
            user_safe_phone = null,
            update_time     =#{update}
        where id = #{userId}
    </update>

    <select id="queryPage" resultMap="BaseResultMap">
        select a.*
        from sys_user a
                     left join sys_user_department b on a.id = b.sys_user_id
                     left join sys_department c on c.id = b.sys_department_id
                     left join sys_user_role d on d.sys_user_id = b.sys_user_id
                     left join sys_role sf on d.sys_role_id = sf.id
                     left join sys_depart_role_user e on e.sys_user_id = b.sys_user_id
                     left join sys_depart_role sdf on e.depart_role_id = sdf.id
                ${ew.customSqlSegment}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-02-->
    <select id="countByUserStatusAndUserDeleteStatus" resultType="java.lang.Integer">
        select count(1)
        from sys_user
        where user_status = #{userStatus,jdbcType=INTEGER}
          and user_delete_status = #{userDeleteStatus,jdbcType=INTEGER}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-02-->
    <select id="findUserStatusById" resultType="java.lang.Integer">
        select user_status
        from sys_user
        where id = #{id,jdbcType=INTEGER}
    </select>

    <select id="findByUserSafePhoneAndUserDeleteStatus" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_safe_phone = #{userSafePhone}
          and user_delete_status = #{userDeleteStatus}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-20-->
    <select id="findByUserPhone" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_phone = #{userPhone,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-20-->
    <select id="findByUserEmail" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_email = #{userEmail,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-30-->
    <select id="findByUserSafePhone" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_safe_phone = #{userSafePhone,jdbcType=VARCHAR}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-04-30-->
    <select id="findByUserSafeEmail" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_safe_email = #{userSafeEmail,jdbcType=VARCHAR}
    </select>


<!--auto generated by MybatisCodeHelper on 2021-12-09-->
    <select id="findByUserAccountNameAndUserStatusAndUserDeleteStatus" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user
        where user_account_name=#{userAccountName,jdbcType=VARCHAR} and user_status=#{userStatus,jdbcType=INTEGER} and
        user_delete_status=#{userDeleteStatus,jdbcType=INTEGER}
    </select>

    <select id="findByUserCode" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_user where user_code = #{userCode}
    </select>
</mapper>
